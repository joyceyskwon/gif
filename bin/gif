#!/usr/bin/env ruby

require 'gif'
require 'optparse'

loops = 1

options = {}
OptionParser.new do |parser|
  parser.on("--l", "--loops") do |times|
    loops = ARGV.find { |arg| /\A\d+\z/.match(arg).to_s.to_i > 0 }
  end

  parser.on("--setup", "--s") do |_|
    options[:setup] = true
    puts "Installing dependencies (gifsicle, imgcat) now..."
    `brew install gifsicle`
    `brew tap eddieantonio/eddieantonio`
    `brew install imgcat`
    puts "Finished installing dependencies!"
  end

  parser.on("--h", "--help", "man") do
    puts [
      "`gif` will play a random gif in your terminal",
      "`gif [search_terms]` will filter by search terms. for example, `gif cute pikachu` will cause you to immediately feel 100% happier.",
      "`--loops` or `--l` will let you loop the gif. for example, `gif cute pikachu --loops 10` will cause you to immediately feel 1000% happier."
    ]
  end
end.parse!

if options[:setup].nil?
  tags = ARGV.join "+"
  gif = Gif::CLI.new tags, loops
  gif.fetch
end
